@using C3_Dominio.Entidades;
@model IEnumerable<Venta>
@{
    ViewBag.Title = "Listar";//~/Recursos/assets
    Layout = "~/Views/MasterPage/Master.cshtml";
}

<div class="wraper container-fluid">
    @*<div class="page-title">
        <h3 class="title">Datatable</h3>
    </div>*@

    <div class="row">
        <div class="col-md-12">
            <div id="panelListaVentas" class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">Ventas</h3>
                    <a id="refrescarTabla" javascript:;" data-toggle="reload"><i class="ion-refresh"></i></a>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <table id="datatable" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Numero - Serie</th>
                                        <th>Fecha</th>
                                        <th>Puesto</th>
                                        <th>Nombres</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @{ 
                                    foreach (Venta venta in Model)
                                    {
                                    <tr>
                                        <td>@venta.serieNumero</td>
                                        <td>@venta.fecha.ToShortDateString()</td>
                                        <td>@venta.trabajador.tipoTrabajador.nombre</td>
                                        <td>@venta.trabajador.generarNombreCompleto()</td>
                                        <td>@venta.total</td>
                                        <td>
                                            
                                                @switch (venta.estado)
                                                {
                                                    case 0:
                                                        <a href="#" id="venta_@venta.id" onclick="cambiarEstadoVenta(@venta.id,this)" ><span class="label label-danger"><text>Anulado</text></span></a> break;
                                                    case 1:
                                                        <a href="#" id="venta_@venta.id" onclick="cambiarEstadoVenta(@venta.id,this)" ><span class="label label-success"><text>Activo</text></span></a> break;
                                                }
                                                
                                            
                                        </td>
                                        <td>UWU</td>
                                    </tr>
                                        }
                                    }
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>





    


@section scripts{

<script src="~/Recursos/assets/datatables/jquery.dataTables.min.js"></script>    
<script src="~/Recursos/assets/datatables/dataTables.bootstrap.js"></script>
<script src="~/Recursos/assets/datatables/dataTables.buttons.min.js"></script>
<script src="~/Recursos/assets/datatables/buttons.bootstrap.min.js"></script>
<script src="~/Recursos/assets/datatables/jszip.min.js"></script>
<script src="~/Recursos/assets/datatables/pdfmake.min.js"></script>
<script src="~/Recursos/assets/datatables/vfs_fonts.js"></script>
<script src="~/Recursos/assets/datatables/buttons.html5.min.js"></script>
<script src="~/Recursos/assets/datatables/buttons.print.min.js"></script>
<script src="~/Recursos/assets/datatables/dataTables.fixedHeader.min.js"></script>
<script src="~/Recursos/assets/datatables/dataTables.keyTable.min.js"></script>
<script src="~/Recursos/assets/datatables/dataTables.responsive.min.js"></script>
<script src="~/Recursos/assets/datatables/responsive.bootstrap.min.js"></script>
<script src="~/Recursos/assets/datatables/dataTables.scroller.min.js"></script>
<script src="~/Recursos/js/datatables.init.js"></script>

<script type="text/javascript">
    $(document).ready(function() {
        $('#datatable').dataTable({
            "language": {
                "url": '../Recursos/lang/Spanish.json'
            }
        });

    });
    TableManageButtons.init();
    var currentId;
    function cambiarEstadoVenta(idVenta, that) {
        console.log("refrescar click");
        currentId = idVenta;
        $.ajax({
            dataType: "html",
            type: "POST",
            url: '@Url.Action("CambiarEstado", "GestionarVenta")',
            data: { id: idVenta },
            beforeSend: function () {
                $('panelListaVentas').append('<div class="panel-disabled"><div class="loader-1"></div></div>');
            },
            complete: function () {
                var $pd = $portlet.find('.panel-disabled');
                $pd.fadeOut('fast', function () {
                    $pd.remove();
                });
            },
            success: function (data) {
                alert('success')
                $('#venta_' + currentId).html(data);
            },
            error: function (xhr) {
                alert('error')
            }

        });
    };



</script>
}